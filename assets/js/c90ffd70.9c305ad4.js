"use strict";(self.webpackChunkavail_docs_wiki=self.webpackChunkavail_docs_wiki||[]).push([[434],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(a),k=o,m=p["".concat(s,".").concat(k)]||p[k]||c[k]||i;return a?n.createElement(m,r(r({ref:t},d),{},{components:a})):n.createElement(m,r({ref:t},d))}));function m(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=k;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:o,r[1]=l;for(var u=2;u<i;u++)r[u]=a[u];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},542:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>k,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var n=a(7462),o=(a(7294),a(3905)),i=a(4996);const r={id:"avail-validator",title:"Run an Avail Validator",sidebar_label:"Run a Validator",description:"Learn about running an Avail validator.",keywords:["docs","avail","node","validator"],image:"https://availproject.github.io/img/avail/AvailDocs.png",slug:"avail-validator"},l=void 0,s={unversionedId:"Running Avail/avail-validator",id:"Running Avail/avail-validator",title:"Run an Avail Validator",description:"Learn about running an Avail validator.",source:"@site/docs/Running Avail/avail-validator.md",sourceDirName:"Running Avail",slug:"/Running Avail/avail-validator",permalink:"/Running Avail/avail-validator",draft:!1,tags:[],version:"current",frontMatter:{id:"avail-validator",title:"Run an Avail Validator",sidebar_label:"Run a Validator",description:"Learn about running an Avail validator.",keywords:["docs","avail","node","validator"],image:"https://availproject.github.io/img/avail/AvailDocs.png",slug:"avail-validator"},sidebar:"defaultSidebar",previous:{title:"Run an Avail node",permalink:"/Running Avail/avail-node-management"},next:{title:"Data Availability",permalink:"/Running Avail/avail-data-avail"}},u={},d=[{value:"Data Availability Deployments",id:"data-availability-deployments",level:2},{value:"Docker Setup",id:"docker-setup",level:2},{value:"Run the latest version of the Docker container",id:"run-the-latest-version-of-the-docker-container",level:3},{value:"Insert private keys",id:"insert-private-keys",level:3},{value:"Bond AVL tokens",id:"bond-avl-tokens",level:2},{value:"Set Session Keys",id:"set-session-keys",level:2},{value:"Rotate you session keys",id:"rotate-you-session-keys",level:3},{value:"Submitting the <code>setKeys</code> transaction",id:"submitting-the-setkeys-transaction",level:3},{value:"Validate",id:"validate",level:2}],p={toc:d},c="wrapper";function k(e){let{components:t,...a}=e;return(0,o.kt)(c,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"data-availability-deployments"},"Data Availability Deployments"),(0,o.kt)("admonition",{title:"Onboarding validators",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"In Avail's current state, the Avail team will maintain the network and run\ninternal validators.")),(0,o.kt)("admonition",{title:"System administration",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"Although Avail is in testnet phase, in general, users should have ",(0,o.kt)("strong",{parentName:"p"},"significant system\nadministration experience")," when running validator nodes."),(0,o.kt)("p",{parentName:"admonition"},"Validator nodes are responsbile for maintaining and securing the network by staking tokens with real\nvalue. Validators need to understand how to manage their node, its associated hardware & configuration,\nand be wary that they are subject to being slashed due to actions like being offline or equivocation."),(0,o.kt)("p",{parentName:"admonition"},"When in doubt, reach out to the Validator Engagement team.")),(0,o.kt)("h2",{id:"docker-setup"},"Docker Setup"),(0,o.kt)("p",null,"The easiest way to deploy your own Avail validator node is using Docker."),(0,o.kt)("h3",{id:"run-the-latest-version-of-the-docker-container"},"Run the latest version of the Docker container"),(0,o.kt)("p",null,"Use the default parameters and expose the P2P port with ",(0,o.kt)("inlineCode",{parentName:"p"},"-p 30333")," by running:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker run -p 30333 --name my_val 0xpolygon/avail:latest\n")),(0,o.kt)("p",null,"Any extra parameter will be added to the ",(0,o.kt)("inlineCode",{parentName:"p"},"data-avail")," binary as an argument.\nIf you want to use a specific node key and limit the maximum number of incoming connections\nto ",(0,o.kt)("inlineCode",{parentName:"p"},"10"),", you can use:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker run -p 30333 --name my_val 0xpolygon/avail:latest --in-peers=10 --node-key 80027666cebec66464611eb0d5c36416213d83a9c689006a80efcf479826de7d\n")),(0,o.kt)("p",null,"This image uses two volumes:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/da/state")," to store the database of the chain"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/da/keystore")," to store the validator's private keys")),(0,o.kt)("p",null,"Most likely you want to bind these volumes to a specific point, like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker run -p 30333 --name my_val -v /volumes/da/state:/da/state -v /volumes/da/keystore/:/da/keystore 0xpolygon/avail:latest\n")),(0,o.kt)("h3",{id:"insert-private-keys"},"Insert private keys"),(0,o.kt)("p",null,"These private keys will be used by the validator to sign blocks and finalize the chain when it\nacts as an active validator. They are stored into ",(0,o.kt)("inlineCode",{parentName:"p"},"/da/keystore")," in plain text format, so you\nshould take extra care over that volume."),(0,o.kt)("p",null,"In order to insert these keys, we will open a shell inside the running container:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker exec -it my_val bash\nroot@5f55e51e5a85:/da# /da/bin/data-avail key insert \\\n      --chain=/da/genesis/testnet.chain.spec.raw.json \\\n      --base-path=/da/state/ \\\n      --keystore-path=/da/keystore/ \\\n      --suri=0x7d98...cae6 \\\n      --key-type=babe \\\n      --scheme=Sr25519\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"--suri")," parameter is the private key as a mnemonic phrase (or secret phrase) where you can generate\none using the ",(0,o.kt)("inlineCode",{parentName:"p"},"subkey")," tool in Substrate."),(0,o.kt)("admonition",{title:"Learn about subkey",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"To learn about how to use the subkey, visit the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.substrate.io/v3/tools/subkey/"},(0,o.kt)("ins",null,"Subkey Substrate documentation")),".")),(0,o.kt)("p",null,"This command should be ",(0,o.kt)("strong",{parentName:"p"},"repeated for each pair of key type and scheme")," shown in the following table:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Key Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Scheme"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"babe"),(0,o.kt)("td",{parentName:"tr",align:null},"Sr25519")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"gran"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("em",{parentName:"td"},"Ed25519"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"imon"),(0,o.kt)("td",{parentName:"tr",align:null},"Sr25519")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"audi"),(0,o.kt)("td",{parentName:"tr",align:null},"Sr25519")))),(0,o.kt)("h2",{id:"bond-avl-tokens"},"Bond AVL tokens"),(0,o.kt)("p",null,"It is highly recommended that you set up a stash and controller account and have separate key (two separate accounts) for both."),(0,o.kt)("admonition",{title:"Stash and Controller Keys",type:"info"},(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"A controller key is used to control staking actions for your account"),(0,o.kt)("li",{parentName:"ul"},"A stash key is used to control your funds. It is recommended that the stash key be a cold wallet or offline and not be used for account-related activities like submitting extrinsics.")),(0,o.kt)("p",{parentName:"admonition"},"Follow the ",(0,o.kt)("a",{parentName:"p",href:"https://wiki.polkadot.network/docs/learn-staking#accounts"},"Polkadot Wiki")," and the\n",(0,o.kt)("a",{parentName:"p",href:"https://docs.substrate.io/v3/concepts/account-abstractions/#:~:text=Controller%20Key%3A%20a%20Controller%20account,somewhat%20regularly%20for%20validator%20maintenance"},"Substrate Hub"),"\nto learn more about stash and controller accounts and how to manage them.")),(0,o.kt)("p",null,"You will start by creating two accounts; ensure each account has enough funds to pay the fees for\nmaking transactions."),(0,o.kt)("admonition",{title:"Storing Funds",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Keep most of your funds in the stash account since it is meant to be the custodian of\nyour staking funds, and have just enough funds in the controller account to pay for fees."),(0,o.kt)("p",{parentName:"admonition"},"Make sure not to bond all your AVL balance since you will be unable to pay transaction fees from your bonded\nbalance.")),(0,o.kt)("p",null,"It is now time to set up your validator by doing the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Bond the AVL of the Stash account. These token will be put at stake for the security of the network and\nsubject to slashing."),(0,o.kt)("li",{parentName:"ul"},"Select the Controller. This is the account that will decide when to start or stop validating.")),(0,o.kt)("p",null,"First, go to the ",(0,o.kt)("strong",{parentName:"p"},"Developer")," tab in the ",(0,o.kt)("a",{parentName:"p",href:"https://devnet-avail.polygon.technology/"},"Avail Apps"),"\nnavbar and click on ",(0,o.kt)("strong",{parentName:"p"},"Extrinsics"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Stash")," account - Select your Stash account. In this example, we bond 1001 AVL tokens, where the\nminimum bonding amount is 1000. Make sure that your Stash account contains at least this many tokens.\nYou can, of course, stake more than this.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Controller")," account - Select the Controller account created earlier. This account will need a\nsmall amount of AVL in order to start and stop validating.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Value")," bonded - The amount of AVL tokens you want to bond from your Stash account."),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"You do not need to bond all of the AVL in that account. Also note that you can always bond more ",(0,o.kt)("inlineCode",{parentName:"p"},"AVL")," later.\nHowever, withdrawing any bonded amount requires the duration of the unbonding period."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Payment")," destination - The account where the rewards from validating are sent. More information can be found\n",(0,o.kt)("a",{parentName:"p",href:"https://wiki.polkadot.network/docs/learn-staking#reward-distribution"},"here"),"."))),(0,o.kt)("img",{src:(0,i.Z)("img/avail/dev-ext.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"Select the ",(0,o.kt)("strong",{parentName:"p"},"staking")," pallet, and the ",(0,o.kt)("strong",{parentName:"p"},"bond")," extrinsic."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/add_validator_bound_step.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"Create a transaction where your ",(0,o.kt)("strong",{parentName:"p"},"stash")," account bounds 1001 AVLs at least to your ",(0,o.kt)("strong",{parentName:"p"},"controller")," account,\nas shown below."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/bond-avl-val.png"),width:"100%",height:"100%"}),(0,o.kt)("h2",{id:"set-session-keys"},"Set Session Keys"),(0,o.kt)("p",null,"Once your node is ",(0,o.kt)("strong",{parentName:"p"},"fully synced"),", you need to rotate and submit your session keys."),(0,o.kt)("h3",{id:"rotate-you-session-keys"},"Rotate you session keys"),(0,o.kt)("p",null,"Run this command on the same machine (while the node is running with the default HTTP RPC port configured):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'docker exec -it my_val bash\nroot@5f55e51e5a85:/da# curl \\\n      -H "Content-Type: application/json" \\\n      -d \'{"id":1, "jsonrpc":"2.0", "method": "author_rotateKeys", "params":[]}\' \\\n      http://localhost:9933\n')),(0,o.kt)("p",null,'The output will have a hex-encoded "result" field. The result is the concatenation of the four public keys.\nSave this result for a later step.'),(0,o.kt)("p",null,"You can restart your node at this point."),(0,o.kt)("h3",{id:"submitting-the-setkeys-transaction"},"Submitting the ",(0,o.kt)("inlineCode",{parentName:"h3"},"setKeys")," transaction"),(0,o.kt)("p",null,"You need to tell the chain your Session keys by signing and submitting an extrinsic. This is what associates\nyour validator with your Controller account."),(0,o.kt)("p",null,"Navigate to the ",(0,o.kt)("a",{parentName:"p",href:"https://devnet-avail.polygon.technology/#/staking"},(0,o.kt)("strong",{parentName:"a"},"Network ","\u2192"," Staking")),".\nHere, you can perform various staking actions. Navigate to ",(0,o.kt)("strong",{parentName:"p"},"Account actions"),", and select ",(0,o.kt)("strong",{parentName:"p"},"Set Session Key"),"\non the bonding account you generated earlier. Enter the output ",(0,o.kt)("inlineCode",{parentName:"p"},"from author_rotateKeys")," in the field and click on\n",(0,o.kt)("strong",{parentName:"p"},"Set Session Key"),"."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/set-session-keys.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"After submitting this extrinsic, you are ready to start validating."),(0,o.kt)("h2",{id:"validate"},"Validate"),(0,o.kt)("p",null,"To verify that your node is live and synchronized, navigate to\n",(0,o.kt)("a",{parentName:"p",href:"https://devnet-avail.polygon.technology/#/staking"},(0,o.kt)("strong",{parentName:"a"},"Network ","\u2192"," Staking"))," and select\n",(0,o.kt)("strong",{parentName:"p"},"Waiting"),". Your account should be shown there. A new validator set is selected every ",(0,o.kt)("strong",{parentName:"p"},"era"),",\nbased on the staking amount."))}k.isMDXComponent=!0}}]);