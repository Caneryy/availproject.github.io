"use strict";(self.webpackChunkavail_docs_wiki=self.webpackChunkavail_docs_wiki||[]).push([[885],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=d(n),h=o,m=c["".concat(l,".").concat(h)]||c[h]||p[h]||i;return n?a.createElement(m,r(r({ref:t},u),{},{components:n})):a.createElement(m,r({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:o,r[1]=s;for(var d=2;d<i;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6807:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var a=n(7462),o=(n(7294),n(3905)),i=n(4996);const r={id:"validator-node-setup",title:"How to Run an Avail Validator",sidebar_label:"Run a Validator Node",sidebar_position:1,description:"Learn about running an Avail validator.",keywords:["docs","avail","node","validator"],image:"https://availproject.github.io/img/avail/AvailDocs.png",slug:"validator-node-setup"},s=void 0,l={unversionedId:"validators/validator-node-setup",id:"validators/validator-node-setup",title:"How to Run an Avail Validator",description:"Learn about running an Avail validator.",source:"@site/docs/validators/validator.md",sourceDirName:"validators",slug:"/validators/validator-node-setup",permalink:"/validators/validator-node-setup",draft:!1,editUrl:"https://github.com/availproject/availproject.github.io/tree/main/docs/validators/validator.md",tags:[],version:"current",lastUpdatedBy:"DSalman03",lastUpdatedAt:1693480437,formattedLastUpdatedAt:"Aug 31, 2023",sidebarPosition:1,frontMatter:{id:"validator-node-setup",title:"How to Run an Avail Validator",sidebar_label:"Run a Validator Node",sidebar_position:1,description:"Learn about running an Avail validator.",keywords:["docs","avail","node","validator"],image:"https://availproject.github.io/img/avail/AvailDocs.png",slug:"validator-node-setup"},sidebar:"validatorsSidebar",next:{title:"Backup Your Validator",permalink:"/validators/avail-backup-node"}},d={},u=[{value:"Data Availability Deployments",id:"data-availability-deployments",level:2},{value:"Running The Node",id:"running-the-node",level:2},{value:"Staking Set-up",id:"staking-set-up",level:2},{value:"Creating accounts",id:"creating-accounts",level:3},{value:"Bonding",id:"bonding",level:3},{value:"Set Session Keys",id:"set-session-keys",level:2},{value:"Rotate your session keys",id:"rotate-your-session-keys",level:3},{value:"Submitting the <code>setKeys</code> transaction",id:"submitting-the-setkeys-transaction",level:3},{value:"Validate",id:"validate",level:2}],c={toc:u},p="wrapper";function h(e){let{components:t,...n}=e;return(0,o.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"data-availability-deployments"},"Data Availability Deployments"),(0,o.kt)("admonition",{title:"Onboarding validators",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Please join our Discord for up-to-date information on our network and\nvalidator onboarding.")),(0,o.kt)("admonition",{title:"System administration",type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"Although Avail is in testnet phase, in general, users should have\n",(0,o.kt)("strong",{parentName:"p"},"significant system administration experience")," when running\nvalidator nodes."),(0,o.kt)("p",{parentName:"admonition"},"Validator nodes are responsbile for maintaining and securing the\nnetwork by staking tokens with real value. Validators need to\nunderstand how to manage their node, its associated hardware &\nconfiguration, and be wary that they are subject to being slashed due\nto actions like being offline or equivocation."),(0,o.kt)("p",{parentName:"admonition"},"When in doubt, reach out to the Validator Engagement team.")),(0,o.kt)("h2",{id:"running-the-node"},"Running The Node"),(0,o.kt)("p",null,"First, explore running a full node as per the\n",(0,o.kt)("a",{parentName:"p",href:"/validators/run-avail/full-node-setup"},"Full Node"),"\ninstructions. This is to familiarise yourself with running a node."),(0,o.kt)("p",null,"To run a validator the command line is the same and requires the addition of the ",(0,o.kt)("inlineCode",{parentName:"p"},"--validator")," option to the command. "),(0,o.kt)("p",null,"For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./data-avail --validator \\\n    --port 30333 \\\n    --base-path `pwd`/data \\\n    --chain `pwd`/chainspec.raw.json\n")),(0,o.kt)("p",null,"The node will ouput the following when started:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'2023-06-03 20:36:29 Avail Node\n2023-06-03 20:36:29 \u270c\ufe0f  version 1.6.0-99b85257d6b\n2023-06-03 20:36:29 \u2764\ufe0f  by Anonymous, 2017-2023\n2023-06-03 20:36:29 \ud83d\udccb Chain specification: Avail Kate Testnet\n2023-06-03 20:36:29 \ud83c\udff7  Node name: bewildered-distance-1229\n2023-06-03 20:36:29 \ud83d\udc64 Role:Authority\n2023-06-03 20:36:29 \ud83d\udcbe Database: RocksDb at /Users/thunder/code/avail/data/chains/Avail Testnet_6831251e-0222-11ee-a2c3-c90377335962/db/full\n2023-06-03 20:36:29 \u26d3  Native runtime: data-avail-9 (data-avail-0.tx1.au11)\n2023-06-03 20:36:35 \ud83d\udc76 Creating empty BABE epoch changes on what appears to be first startup.\n2023-06-03 20:36:35 \ud83c\udff7  Local node identity is: 12D3KooWPt7odw3aeq7azZDugXjNuUvQNPU58n1VRBzY1YBqsjkr\n2023-06-03 20:36:35 Prometheus metrics extended with avail metrics\n2023-06-03 20:36:35 \ud83d\udcbb Operating system: macos\n2023-06-03 20:36:35 \ud83d\udcbb CPU architecture: aarch64\n2023-06-03 20:36:35 \ud83d\udce6 Highest known block at #0\n2023-06-03 20:36:35 \u303d\ufe0f Prometheus exporter started at 127.0.0.1:9615\n2023-06-03 20:36:35 Running JSON-RPC HTTP server: addr=127.0.0.1:9933, allowed origins=["http://localhost:*", "http://127.0.0.1:*", "https://localhost:*", "https://127.0.0.1:*", "https://polkadot.js.org"]\n2023-06-03 20:36:35 Running JSON-RPC WS server: addr=127.0.0.1:9944, allowed origins=["http://localhost:*", "http://127.0.0.1:*", "https://localhost:*", "https://127.0.0.1:*", "https://polkadot.js.org"]\n2023-06-03 20:36:35 \ud83c\udfc1 CPU score: 724.71 MiBs\n2023-06-03 20:36:35 \ud83c\udfc1 Memory score: 41.49 GiBs\n2023-06-03 20:36:35 \ud83c\udfc1 Disk score (seq. writes): 1.91 GiBs\n2023-06-03 20:36:35 \ud83c\udfc1 Disk score (rand. writes): 454.66 MiBs\n')),(0,o.kt)("admonition",{title:"Node Role",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Note that the Role now has a value of ",(0,o.kt)("inlineCode",{parentName:"p"},"Authority"),", this indicates it is a validator node.")),(0,o.kt)("p",null,"If you were running a full node and added the ",(0,o.kt)("inlineCode",{parentName:"p"},"--validator")," flag after syncing a full node you will get an error that it is expecting an archive database. You can purge the database and restart the node."),(0,o.kt)("p",null,"It is strongly recommended to run your node as a service."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo tee /etc/systemd/system/availd.service > /dev/null <<'EOF'\n[Unit]\nDescription=Avail Validator\nAfter=network.target\nStartLimitIntervalSec=0\n\n[Service]\nUser=avail\nType=simple\nRestart=always\nRestartSec=120\nExecStart=/home/avail/avail-node/data-avail --base-path /home/avail/avail-node/data --chain /home/avail/avail-node/chainspec.raw.json --port 30333 --validator --name MyAvailNode\n\n[Install]\nWantedBy=multi-user.target\nEOF\n")),(0,o.kt)("p",null,"Enable auto restart on for your Avail node:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl daemon-reload\nsudo systemctl enable availd.service \n")),(0,o.kt)("p",null,"Start your avail node:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl start availd.service \n")),(0,o.kt)("p",null,"Check the node is running:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl status availd.service\n")),(0,o.kt)("p",null,"View the logs from the running service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"journalctl -f -u availd.service\n")),(0,o.kt)("h2",{id:"staking-set-up"},"Staking Set-up"),(0,o.kt)("p",null,"Once the node is running and connected to the network, it needs to be\nlinked to accounts with bonded (staked) funds in order to be eligible\nto become an active validator."),(0,o.kt)("h3",{id:"creating-accounts"},"Creating accounts"),(0,o.kt)("p",null,"We recommend creating two accounts, ",(0,o.kt)("inlineCode",{parentName:"p"},"stash")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"controller"),", each\nwith their own key:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The controller key is used to control staking actions and submitting\ntransactions (paying for transaction fees)."),(0,o.kt)("li",{parentName:"ul"},"The stash key is used to control most of your funds. It is\nrecommended that the stash key be a cold wallet or offline and not\nbe used for account-related activities like submitting extrinsics.")),(0,o.kt)("p",null,"You can create the two accounts via the Explorer interface. The Kate\nnetwork explorer is at ",(0,o.kt)("a",{parentName:"p",href:"https://kate.avail.tools/"},"kate.avail.tools"),",\nfor other networks refer to the ",(0,o.kt)("a",{parentName:"p",href:"/validators/networks"},"Avail\nNetworks")," page."),(0,o.kt)("p",null,"Once you have created the accounts, Ensure each account has enough\nfunds to pay the fees for making transactions. For validators\nparticipating in our testnet, contact the Avail team to have funds\ntransferred."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/stash-controller-accounts.png"),width:"200%",height:"200%"}),(0,o.kt)("admonition",{title:"Storing Funds",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Keep most of your funds in the stash account since it is meant to be\nthe custodian of your staking funds, and have just enough funds in the\ncontroller account to pay for fees."),(0,o.kt)("p",{parentName:"admonition"},"Make sure not to bond all your AVL balance since you will be unable to\npay transaction fees from your bonded balance.")),(0,o.kt)("h3",{id:"bonding"},"Bonding"),(0,o.kt)("p",null,"It is now time to set up your validator by doing the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Bond the AVL of the Stash account. These token will be put at stake\nfor the security of the network and subject to slashing."),(0,o.kt)("li",{parentName:"ul"},"Select the Controller. This is the account that will decide when to start or stop validating.")),(0,o.kt)("p",null,"First, go to the accounts section on the ",(0,o.kt)("strong",{parentName:"p"},"Staking")," tab in the\nExplorer at\n",(0,o.kt)("a",{parentName:"p",href:"https://kate.avail.tools/#/staking/actions"},"kate.avail.tools")," for the\nKate network (for other networks refer to the ",(0,o.kt)("a",{parentName:"p",href:"/validators/networks"},"Avail\nNetworks")," page). Here, you can perform\nvarious staking actions. Click on Stash."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/staking-bond-1.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"The bonding preferences window will open with the following options:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Stash account:")," Your Stash account."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Controller account:")," Select your Controller account. This account\nonly needs a small amount of AVL in order to start and stop\nvalidating."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Value bonded:")," The amount of AVL tokens you want to bond from\nyour Stash account. You may stake any amount above the minimum."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Payment destination:")," The account where the rewards from\nvalidating are sent. More information can be found\n",(0,o.kt)("a",{parentName:"li",href:"https://wiki.polkadot.network/docs/learn-staking#reward-distribution"},"here"),".")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You should not bond all of the AVL in that account, you will require\nsome AVL for transactions. Also note that you can always bond more\n",(0,o.kt)("inlineCode",{parentName:"p"},"AVL")," later.  However, withdrawing any bonded amount requires the\nduration of the unbonding period.")),(0,o.kt)("p",null,"Once populating the fields you can click bond. You will then be\npromted to enter your wallet password. Enter your password and then\nclick ",(0,o.kt)("strong",{parentName:"p"},"Sign and Submit"),"."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/staking-bond-3.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"You should now be ready to generate your session keys. Note the\n",(0,o.kt)("strong",{parentName:"p"},"Session Key")," button, in the next step we will generate a key to\nsubmit here.  ",(0,o.kt)("img",{src:(0,i.Z)("img/avail/staking-bond-4.png"),width:"100%",height:"100%"})),(0,o.kt)("h2",{id:"set-session-keys"},"Set Session Keys"),(0,o.kt)("p",null,"Once your node is ",(0,o.kt)("strong",{parentName:"p"},"fully synced"),", you need to rotate and submit your\nsession keys."),(0,o.kt)("h3",{id:"rotate-your-session-keys"},"Rotate your session keys"),(0,o.kt)("p",null,"Run this command on the machine where you are running your Avail\nvalidator node (while the node is running with the default HTTP RPC\nport configured):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'curl -H "Content-Type: application/json" -d \'{"id":1, "jsonrpc":"2.0", "method": "author_rotateKeys", "params":[]}\' http://localhost:9933\n')),(0,o.kt)("p",null,'The output will have a hex-encoded "result" field. The result is the\nconcatenation of the four public keys.  Save this result for a later\nstep.'),(0,o.kt)("p",null,"You should now restart the node so it will use the new session keys."),(0,o.kt)("h3",{id:"submitting-the-setkeys-transaction"},"Submitting the ",(0,o.kt)("inlineCode",{parentName:"h3"},"setKeys")," transaction"),(0,o.kt)("p",null,"You need to tell the chain your Session keys by signing and submitting\nan extrinsic. This is what associates your validator with your\nController account."),(0,o.kt)("p",null,"Navigate back to the ",(0,o.kt)("a",{parentName:"p",href:"https://kate.avail.tools/#/staking/actions"},(0,o.kt)("strong",{parentName:"a"},"Network ","\u2192","\nStaking"))," if you\nclosed the window.  Ensure you are on ",(0,o.kt)("strong",{parentName:"p"},"Account actions"),", and select\n",(0,o.kt)("strong",{parentName:"p"},"Set Session Key")," on the bonding account you generated earlier.\nEnter the output ",(0,o.kt)("inlineCode",{parentName:"p"},"from author_rotateKeys")," in the field and click on\n",(0,o.kt)("strong",{parentName:"p"},"Set Session Key"),". Will be promted for password again."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/set-session-keys.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"After submitting this extrinsic, you will notice ",(0,o.kt)("strong",{parentName:"p"},"Set Session Key"),"\nchanged to ",(0,o.kt)("strong",{parentName:"p"},"Validate"),". Ensure your node is in sync before\nproceeding."),(0,o.kt)("h2",{id:"validate"},"Validate"),(0,o.kt)("p",null,"If you are ready to start validating you must click ",(0,o.kt)("strong",{parentName:"p"},"Validate")),(0,o.kt)("img",{src:(0,i.Z)("img/avail/start-validating.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"You will be prompted to enter your validator commission\npercentage. Once you click on ",(0,o.kt)("strong",{parentName:"p"},"Validate")," you will be prompted for\nyour password."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/set-validate-commission.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"Your validator is now ready to start validating. You can click the\nstop icon should you wish to exit. Note that the Avail interface does\nnot check if your node is in sync.  You need to ensure your node is in\nsync. The Avail blockchain will select your node in the next epoch or\ntwo if you have enough stake."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/validator-ready.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"To verify that your node is ready for possible selection at the end of\nthe next era , navigate to ",(0,o.kt)("a",{parentName:"p",href:"https://kate.avail.tools/#/staking"},(0,o.kt)("strong",{parentName:"a"},"Network ","\u2192","\nStaking"))," and select\n",(0,o.kt)("strong",{parentName:"p"},"Waiting"),". Your account should be shown there. A new validator set\nis selected every ",(0,o.kt)("strong",{parentName:"p"},"era"),", based on the staking amount."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/validator-waiting-list.png"),width:"100%",height:"100%"}),(0,o.kt)("p",null,"When the validator node has enough stake it will be elected, below is\nan example of the node being elected and making blocks."),(0,o.kt)("img",{src:(0,i.Z)("img/avail/validator-active-set.png"),width:"100%",height:"100%"}))}h.isMDXComponent=!0}}]);